<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- android -->
	<link rel="icon" sizes="192x192" href="img/icons/192.png">

	<!-- ios -->
	<link rel="apple-touch-icon" href="img/icons/80.png">
	<link rel="apple-touch-icon" sizes="152x152" href="img/icons/152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="img/icons/180.png">
	<link rel="apple-touch-icon" sizes="167x167" href="img/icons/167.png">

	<link href="img/favicon.ico" rel="shortcut icon">

	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/default.min.css">
	<link rel="stylesheet" href="styles.css">

	<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js"></script>
	<script>hljs.initHighlightingOnLoad();</script>

	<title>Wavemeter web server</title>

</head>
<body>
<a href="https://github.com/stepansnigirev/py-ws7" id="fork"><img src="img/fork.png"/></a>
<div class="hero">
	<h1>Wavemeter web server</h1>
	<p>Brings <a href="http://www.highfinesse.com/en/wavelengthmeter">HighFinesse</a> wavemeter interface to your browser, phone or web application.</p>
	<div class="screenholder">
		<img src="img/screenshots/screenshot2.png"/>
	</div>
	<div class="btnholder">
		<a href="demo/" class="btn">
			<svg height="24" viewBox="0 0 24 24" width="24" xmlns="http://www.w3.org/2000/svg">
			    <path d="M0 0h24v24H0z" fill="none"/>
			    <path d="M19 19H5V5h7V3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2v-7h-2v7zM14 3v2h3.59l-9.83 9.83 1.41 1.41L19 6.41V10h2V3h-7z"/>
			</svg>
			View demo
		</a>
		<a href="https://github.com/stepansnigirev/py-ws7" class="btn">
			<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 36 36" enable-background="new 0 0 36 36" xml:space="preserve">
				<path fill-rule="evenodd" clip-rule="evenodd" d="M18,1.4C9,1.4,1.7,8.7,1.7,17.7c0,7.2,4.7,13.3,11.1,15.5
			c0.8,0.1,1.1-0.4,1.1-0.8c0-0.4,0-1.4,0-2.8c-4.5,1-5.5-2.2-5.5-2.2c-0.7-1.9-1.8-2.4-1.8-2.4c-1.5-1,0.1-1,0.1-1
			c1.6,0.1,2.5,1.7,2.5,1.7c1.5,2.5,3.8,1.8,4.7,1.4c0.1-1.1,0.6-1.8,1-2.2c-3.6-0.4-7.4-1.8-7.4-8.1c0-1.8,0.6-3.2,1.7-4.4
			c-0.2-0.4-0.7-2.1,0.2-4.3c0,0,1.4-0.4,4.5,1.7c1.3-0.4,2.7-0.5,4.1-0.5c1.4,0,2.8,0.2,4.1,0.5c3.1-2.1,4.5-1.7,4.5-1.7
			c0.9,2.2,0.3,3.9,0.2,4.3c1,1.1,1.7,2.6,1.7,4.4c0,6.3-3.8,7.6-7.4,8c0.6,0.5,1.1,1.5,1.1,3c0,2.2,0,3.9,0,4.5
			c0,0.4,0.3,0.9,1.1,0.8c6.5-2.2,11.1-8.3,11.1-15.5C34.3,8.7,27,1.4,18,1.4z"/>
			</svg>
			Fork on Github
		</a>
	</div>
</div>
<main>
	<h2>Features</h2>
	<div id="features">
		<div>
			<div>
				<img src="img/devices.svg">
				Responsive interface looks nice both on desktop and mobile.
			</div>
			<div>
				<img src="img/fullscreen.svg">
				Wavelength value fills all available space so you can see it even from other side of the lab.
			</div>
		</div>
		<div>
			<div>
				<img src="img/code.svg">
				Simple HTTP API, python and javascript libraries that you can use in your control system.
			</div>
			<div>
				<img src="img/gear.svg">
				Single json configuration file allows flexible configuration to meet your needs.
			</div>
		</div>
	</div>
	<h2>Requirements</h2>
	<ul>
		<li>Windows computer with HighFinesse software installed</li>
		<li><a href="https://www.python.org/downloads/">Python</a> 2.7 or 3</li>
		<li><a href="http://www.tornadoweb.org/en/stable/">Tornado</a> web framework (run <code>pip install tornado</code> to get it)</li>
	</ul>
	<h2>Quick start</h2>
	<ul>
		<li>Make sure that HighFinesse wavemeter application is running and measuring the wavelength</li>
		<li>Browse to the webserver folder and run the server script: <code>python server.py</code></li>
		<li>Wavemeter interface should be now available on <a href="http://localhost:8000/">http://localhost:8000/</a></li>
	</ul>
	<h2>Configuration</h2>
	<p>
		You can configure the webserver via configuration file and overwrite a few options with command line arguments when starting the server. Let's first have a look at the configuration file. By default server is trying to load <code>config.json</code> file from the same folder. This behaviour can be changed by command line flags that we cover later.
	</p>
	<h3>Configuration file</h3>
	<p>
		Configuration file looks like this:
	</p>
	<pre><code class="json">{
  "precision": 5,
  "port": 8000,
  "channels": [
    { "i": 0, "label": "Blue master"},
    {
      "i": 4,
      "label": "TiSa",
      "background": "#300"
    },
    { "i": 1, "label": "Red master"},
    { "i": 2, "label": "Repumper 679 nm"},
    { "i": 3, "label": "Repumper 707 nm"}
  ],
  "root": "/"
}</code></pre>
	<p>
		<b>Precision</b> defines number of decimal digits displayed in the wavelength value. For <code>"precision": 5</code> you will get something like <b>460.86180</b>.
	</p>
	<p>
		<b>Port</b> defines http port to listen to. By default the web interface will be available on <a href="http://localhost:8000/">http://localhost:8000/</a>, if you want to get it on <a href="http://localhost/">http://localhost/</a> set port to <b>80</b>. Alternatively you can use Apache or Nginx to route certain requests to the wavemeter server.
	</p>
	<p>
		<b>Channels</b> is an array of wavemeter channels that you are interested in. You can leave only channels that you are using to make interface cleaner. Every channel can have a <b>label</b> and if you are not happy with default background calculated from the wavelength — custom <b>background</b>.
	</p>
	<p>
		<b>Root</b> defines url where you want to get the wavemeter. For example if you want to make it available on <a href="http://localhost:8000/wavemeter/">http://localhost:8000/wavemeter/</a> set <code>"root": "/wavemeter/"</code>.
	</p>
	<h3>Command line arguments</h3>
	<p>
		Add flag <code>--debug</code> to run server in debug mode that doesn't require wavemeter, HighFinesse application and can run on Linux or MacOS
	</p>
	<p>
		Use <code>-c /path/to/config/file</code> to set configuration file instead of default.
	</p>
	<p>
		Use <code>-r /root/path/</code> to overwrite url of the server.
	</p>
	<p>
		Add port number to change it.
	</p>
	<p>
		For example, running <code>python server.py --debug -c ./config-example.json -r /wavemeter/ 80</code> will start server in debug mode on port 80 with configuration loaded from <code>config-example.json</code> and will be available on <a href="http://localhost/wavemeter/">http://localhost/wavemeter/</a>
	</p>
	<h2>API and libraries</h2>
	<p>
		Server also includes a few ways to use it in your own projects. It's python module that allows to communicate to the wavemeter directly without a server, HTTP API to get information via simple HTTP requests and a javascript library to embed wavemeter functionality to your web page.
	</p>
	<h3>Python module</h3>
	<p>
		The simplest example that prints wavelengths values from the wavemeter looks like this:
	</p>
	<pre><code class="python">from wlm import *

wlm = WavelengthMeter()

for i, v in enumerate(wlm.wavelengths):
  print("Wavelength at channel %d:\t%.4f nm" % (i, v))
	</code></pre>
	<p>
		WavelengthMeter class accepts two optional arguments:
	</p>
	<ul>
		<li><code>dllpath</code> — path to the <code>wlmData.dll</code>. Default is <code>C:\Windows\System32\wlmData.dll</code></li>
		<li><code>debug</code> — partialy emulates work of the dll library without accessing it, default is <code>False</code></li>
	</ul>
	<p>
		Class has the following properties:
	</p>
	<ul>
		<li><code>wavelengths</code> — array of all wavelengths (from channel 1 to 8)</li>
		<li><code>wavelength</code> — wavelength of the first channel</li>
		<li><code>switcher_mode</code> — set to True if you want to measure all channels, set to False to measure only active channel</li>
	</ul>
	<h3>HTTP API</h3>
	<p>
		When server is running you can get wavelengths in json format by simple http requests.

		Try adding <a href="http://localhost:8000/api/">/api/</a> to the url, or <a href="http://localhost:8000/api/3/">/api/3/</a> to get wavelength of corresponding channel (channels here start from 0).
	</p>
	<h3>Javascript library</h3>
	<p>
		You can insert realtime wavelength from the wavemeter in any http page. It is quite usefull when you have a web control interface of the laser and want to see the wavelength during adjustments.
	</p>
	<p>
		To start working with it you need to include the library and initialize it with several options:
	</p>
	<pre><code class="html">&lt;script src="http://localhost:8000/static/wlm.js"&gt;&lt;/script&gt;
&lt;script type="text/javascript"&gt;
  wlm = Wavemeter({
    "url": "http://localhost:8000/", // defines url to connect
    "precision": 5, // defines representation of the wavelength
    "channels": [ // array of channels and element's ids
      { "channel": 0, "element": "mydiv"},
      { "channel": 3, "element": "myotherdiv"},
    ]
  });
  wlm.start();
&lt;/script&gt;</code></pre>

	<p>
		After that wavelength values of channel 0 and 3 will be putted in elements with ids `mydiv` and `myotherdiv`. Wavelengths are also available from javascript as `wlm.wavelengths`.
	</p>
	<p>
		You can also ask the library to call a custom function every time it gets new data. For example the following code will write "Resonant" in a div with `id="status"` if wavelength of the 4th channel is close to 707.2017 or "Detuned" otherwise.
	</p>

	<pre><code class="javascript">wlm.onupdate(function(data){
  var w = data[3];
  if(Math.abs(w-707.2017)&lt;0.0001){
    document.getElementById("status").innerHTML = "Resonant";
  }else{
    document.getElementById("status").innerHTML = "Detuned";
  }
});</code></pre>

	<p>
		If you want to indicate disconnect event, there is a function for that:
	</p>

	<pre><code class="javascript">wlm.onclose(function(){
  document.getElementById("status").innerHTML = "No connection";
});</code></pre>

	<p>
		Example page can be found at <a href="http://localhost:8000/static/wlmjs_test.html">http://localhost:8000/static/wlmjs_test.html</a>.
	</p>
</main>
</body>
</html>